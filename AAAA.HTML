<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高程计算器</title>
</head>
<style>
    .main {
        width: 500px;
        margin: 0 auto;
    }
    table {
        margin: 10px 0 0 0;
        border: none;
        text-align: center;
        width: 800px;
    }
</style>

<body>
    <div class="main">
        <p> <label for="">设计高程：</label><input id="shejigaocheng" type="number" value="176.653"
                onchange="shejigaochengChange()"></p>
        <p> <label for="">高程：</label><input id="gaocheng" type="number" value="161.757" onchange="gaochengChange()"></p>
        <button id="comp">生成数据</button>
        <button id="clear">清空数据</button>
        <div>
            <table border="1">
                <thead>
                    <td>序号</td>
                    <td>后视</td>
                    <td>视线高程</td>
                    <td>前视</td>
                    <td>高程</td>
                </thead>
                <tbody id="result">
                </tbody>
            </table>

        </div>
    </div>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/mathjs/10.5.1/math.js"></script>
    <script>
        function RandomNumBoth(Min, Max) {
            var Range = Max - Min;
            var Rand = Math.random();
            var num = Min + Math.round(Rand * Range); //四舍五入
            return num;
        }

        function getRandomData() {
            return {
                qianshi: RandomNumBoth(100, 1000),
                houshi: RandomNumBoth(1000, 5000)
            }
        }

        let shejigaocheng = Number($("#shejigaocheng").val()) * 1000
        let gaocheng = Number($("#gaocheng").val()) * 1000

        let result = [{
            gaochengTemp: Number($("#shejigaocheng").val()) * 1000
        }]
        let index = 0;

        function gaochengChange() {
            gaocheng = Number($("#gaocheng").val()) * 1000

        }
        function shejigaochengChange() {
            shejigaocheng = Number($("#shejigaocheng").val()) * 1000
            result[0].gaochengTemp = shejigaocheng
        }
      
        function comp() {
            index++
            let comphandle = getRandomData()
            let shixianGaochengTemp = math.add(result[index - 1].gaochengTemp, comphandle.qianshi)
            let gaochengTemp = math.subtract(shixianGaochengTemp, comphandle.houshi) //高程
            if (math.subtract(gaochengTemp, gaocheng) > comphandle.houshi) {
                result.push({ gaochengTemp: gaochengTemp, shixianGaochengTemp, fatherGaohceng: result[index - 1].gaochengTemp, comp: comphandle, index })
                comp()
            } else {
                result.push({
                    gaochengTemp: gaocheng, shixianGaochengTemp, fatherGaohceng: result[index - 1].gaochengTemp, comp: comphandle, index
                })
                return
            }
        }

        $("#comp").click(function () {
            comp()
            const html = result.reduce((pre, cur) => {
                return pre = pre + `<tr><td>${cur.index || 0}</td><td>${(cur.comp && cur.comp.houshi / 1000) || ""}</td><td>${cur.shixianGaochengTemp / 1000}</td> <td>${(cur.comp && cur.comp.qianshi / 1000) || ""}</td> <td>${cur.gaochengTemp / 1000}</td></tr>`
            }, '')
            $("#result").html(html)
        })
        $("#clear").click(function () {
            result = [{
                gaochengTemp: Number($("#shejigaocheng").val()) * 1000
            }]
            index = 0;
            $("#result").html("")
        })
    </script>
    </body>
    </html>